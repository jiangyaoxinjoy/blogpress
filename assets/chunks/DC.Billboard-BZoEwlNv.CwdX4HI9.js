import{e as r}from"./namespace-BzafXSza.D48SLZaH.js";class l{constructor(){this._eventCache={}}_registerEvent(){}_on(e,i,s){let a=this.getEvent(e);i&&a&&a.addEventListener(i,s||this)}_off(e,i,s){let a=this.getEvent(e);a&&i&&a.removeEventListener(i,s||this)}_fire(e,i){let s=this.getEvent(e);s&&s.raiseEvent(i)}on(e,i,s){return this._on(e,i,s),this}off(e,i,s){return this._off(e,i,s),this}fire(e,i){return this._fire(e,i),this}getEvent(e){return this._eventCache[e]||void 0}}class _ extends l{constructor(){super(),this._registerEvent()}_registerEvent(){for(let e in DC.LayerEventType){let i=DC.LayerEventType[e];this._eventCache[i]=new r.Event}}}class y extends l{constructor(){super(),this._registerEvent()}_registerEvent(){for(let e in DC.MouseEventType){let i=DC.MouseEventType[e];this._eventCache[i]=new r.Event}for(let e in DC.OverlayEventType){let i=DC.OverlayEventType[e];this._eventCache[i]=new r.Event}}}class v{constructor(e){this._id=e||DC.Util.uuid(),this._delegate=void 0,this._viewer=void 0,this._state=void 0,this._show=!0,this._cache={},this._attr={},this._style={},this._layerEvent=new _,this._layerEvent.on(DC.LayerEventType.ADD,this._addCallback,this),this._layerEvent.on(DC.LayerEventType.REMOVE,this._removeCallback,this),this._layerEvent.on(DC.LayerEventType.ADD_OVERLAY,this._addOverlayCallback,this),this._layerEvent.on(DC.LayerEventType.REMOVE_OVERLAY,this._removeOverlayCallback,this),this.type=void 0}set show(e){this._show=e,this._delegate&&(this._delegate.show=this._show)}get show(){return this._show}get layerEvent(){return this._layerEvent}set attr(e){this._attr=e}get attr(){return this._attr}get id(){return this._id}get delegate(){return this._delegate}get state(){return this._state}_addCallback(e){this._viewer=e,this._delegate&&(this._delegate instanceof r.PrimitiveCollection?this._viewer.delegate.scene.primitives.add(this._delegate):this._viewer.delegate.dataSources.add(this._delegate),this._state=DC.LayerState.ADDED)}_removeCallback(){this._delegate&&this._viewer&&(this._cache={},this._delegate instanceof r.PrimitiveCollection?(this._delegate.removeAll(),this._viewer.delegate.scene.primitives.remove(this._delegate)):this._delegate.then?(this._delegate.then(e=>{e.entities.removeAll()}),this._viewer.delegate.dataSources.remove(this._delegate)):(this._delegate.entities&&this._delegate.entities.removeAll(),this._viewer.delegate.dataSources.remove(this._delegate)),this._state=DC.LayerState.REMOVED)}_addOverlayCallback(e){e&&e.overlayEvent&&e.state!==DC.OverlayState.ADDED&&(e.overlayEvent.fire(DC.OverlayEventType.ADD,this),this._cache[e.id]=e)}_removeOverlayCallback(e){e&&e.overlayEvent&&e.state!==DC.OverlayState.REMOVED&&(e.overlayEvent.fire(DC.OverlayEventType.REMOVE,this),delete this._cache[e.id])}addOverlay(e){return this._addOverlayCallback(e),this}removeOverlay(e){return this._removeOverlayCallback(e),this}getOverlay(e){return this._cache[e]||void 0}getOverlayByAttr(e,i){let s;for(let a in this._cache)this._cache[a].attr[e]===i&&(s=this._cache[a]);return s}eachOverlay(e,i){for(let s in this._cache)e.call(i,this._cache[s]);return this}clear(){}remove(){this._viewer&&this._viewer.removeLayer(this)}addToViewer(e){return e&&e.addLayer&&e.addLayer(this),this}setStyle(e){}}class n{constructor(){this._id=DC.Util.uuid(),this._layer=void 0,this._state=void 0,this._delegate=void 0,this._show=!0,this._style={},this._attr={},this._overlayEvent=new y,this.type=void 0,this.on(DC.OverlayEventType.ADD,this._addCallback,this),this.on(DC.OverlayEventType.REMOVE,this._removeCallback,this)}get id(){return this._id}set show(e){this._show=e,this._delegate&&(this._delegate.show=this._show)}get show(){return this._show}set attr(e){this._attr=e}get attr(){return this._attr}get overlayEvent(){return this._overlayEvent}get delegate(){return this._delegate}get state(){return this._state}_prepareDelegate(){}_addCallback(e){this._layer=e,this._prepareDelegate(),this._layer&&this._layer.delegate&&this._layer.delegate.entities&&(this._layer.delegate.entities.add(this._delegate),this._state=DC.OverlayState.ADDED)}_removeCallback(){this._layer&&this._layer.delegate&&this._layer.delegate.entities&&(this._layer.delegate.entities.remove(this._delegate),this._state=DC.OverlayState.REMOVED)}setStyle(e){}remove(){this._layer&&this._layer.removeOverlay(this)}addToLayer(e){e&&e.addOverlay(this)}on(e,i,s){return this._overlayEvent.on(e,i,s||this),this}off(e,i,s){return this._overlayEvent.off(e,i,s||this),this}fire(e,i){return this._overlayEvent.fire(e,i),this}}DC.Polygon=class extends n{constructor(t){if(!t||typeof t!="string"&&!Array.isArray(t))throw new Error("the positions invalid");super(),this._positions=this._preparePositions(t),this._holes=[],this._delegate=new r.Entity,this._state=DC.OverlayState.INITIALIZED,this.type=DC.OverlayType.POLYGON}set positions(t){this._positions=this._preparePositions(t)}get positions(){return this._positions}set holes(t){t&&t.length&&(this._holes=t.map(e=>this._preparePositions(e)))}get holes(){return this._holes}get center(){let t=r.BoundingSphere.fromPoints(DC.T.transformWSG84ArrayToCartesianArray(this._positions));return DC.T.transformCartesianToWSG84(t.center)}get area(){let t=0;if(this._positions){let e=0,i=r.Ellipsoid.WGS84,s=[...this._positions];s.push(s[0]);for(let a=1;a<s.length;a++){let o=i.cartographicToCartesian(DC.T.transformWSG84ToCartographic(s[a-1])),h=i.cartographicToCartesian(DC.T.transformWSG84ToCartographic(s[a]));e+=o.x*h.y-h.x*o.y}t=Math.abs(e).toFixed(2)}return t}_preparePositions(t){if(typeof t=="string"){if(t.indexOf("#")>=0)throw new Error("the positions invalid");t=t.split(";")}return t.map(e=>Array.isArray(e)?DC.Position.fromCoordArray(e):e instanceof DC.Position?e:DC.Position.fromCoordString(e))}_prepareHierarchy(){let t=new r.PolygonHierarchy;return t.positions=DC.T.transformWSG84ArrayToCartesianArray(this._positions),t.holes=this._holes.map(e=>new r.PolygonHierarchy(DC.T.transformWSG84ArrayToCartesianArray(e))),t}_prepareDelegate(){this._delegate.polygon={...this._style,hierarchy:new r.CallbackProperty(t=>this._prepareHierarchy())},this._delegate.layer=this._layer,this._delegate.overlayId=this._id}setStyle(t){return!t||Object.keys(t).length===0?this:(this._style=t,this._delegate.polygon&&DC.Util.merge(this._delegate.polygon,this._style),this)}static fromEntity(t){let e;if(t.polygon){let i=DC.T.transformCartesianArrayToWSG84Array(t.polygon.hierarchy.getValue(r.JulianDate.now()).positions);e=new DC.Polygon(i),e.attr={...t.properties}}return e}};DC.OverlayType.POLYGON="polygon";DC.Billboard=class extends n{constructor(t,e){if(!t||!(t instanceof DC.Position))throw new Error("the position invalid");super(),this._position=t,this._icon=e,this._size=[32,32],this._delegate=new r.Entity,this._state=DC.OverlayState.INITIALIZED,this.type=DC.OverlayType.BILLBOARD}set position(t){if(!t||!(t instanceof DC.Position))throw new Error("the position invalid");this._position=t}get position(){return this._position}set icon(t){this._icon=t}get icon(){return this._icon}set size(t){this._size=t}get size(){return this._size}_prepareDelegate(){this._delegate.position=new r.CallbackProperty(t=>DC.T.transformWSG84ToCartesian(this._position)),this._delegate.orientation=new r.CallbackProperty(t=>r.Transforms.headingPitchRollQuaternion(DC.T.transformWSG84ToCartesian(this._position),new r.HeadingPitchRoll(r.Math.toRadians(this._position.heading),r.Math.toRadians(this._position.pitch),r.Math.toRadians(this._position.roll)))),this._delegate.billboard={...this._style,image:new r.CallbackProperty(t=>this._icon),width:new r.CallbackProperty(t=>this._size[0]||32),height:new r.CallbackProperty(t=>this._size[1]||32)},this._delegate.layer=this._layer,this._delegate.overlayId=this._id}setLabel(t,e){return this._delegate.label={...e,text:t},this}setStyle(t){return Object.keys(t).length===0?this:(this._style=t,this._delegate.billboard&&DC.Util.merge(this._delegate.billboard,this._style),this)}static fromEntity(t){let e=DC.T.transformCartesianToWSG84(t.position._value),i;return t.billboard&&(i=new DC.Billboard(e,t.billboard.image),i.attr={...t.properties}),i}};DC.OverlayType.BILLBOARD="billboard";export{l,n as o,v};
